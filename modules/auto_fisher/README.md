# AutoFish 自动钓鱼模块 v3.0

## 模块简介

AutoFish自动钓鱼模块是基于YOLO深度学习模型的智能钓鱼辅助工具，能够自动识别游戏中的钓鱼状态并执行相应操作，实现全自动钓鱼。

## 功能特点

- **智能状态识别**：使用YOLO模型准确识别11种钓鱼状态
- **精确操作控制**：模拟真实的鼠标键盘操作，包括随机点击间隔
- **高度可配置**：支持自定义热键、状态显示和操作参数
- **实时状态显示**：在屏幕显示当前识别的钓鱼状态和运行信息
- **用户友好界面**：简洁明了的操作界面，一键开始/停止
- **状态稳定性**：采用状态计数器确保状态检测的稳定性
- **模块化设计**：清晰的组件划分，便于维护和扩展

## 系统要求

- Windows 10/11
- Python 3.8+
- CUDA支持的NVIDIA显卡（可选，用于加速）

## 快速开始

1. **直接启动**：
   ```
   python modules/auto_fisher/main.py
   ```
   或双击`run_fishing.bat`

2. **从主程序启动**：
   ```
   python main.py
   ```
   然后点击"自动钓鱼模块"按钮

3. **测试模式**：
   ```
   python modules/auto_fisher/test_state_machine.py --test [detection|clicking|transition]
   ```

## 使用说明

1. 启动程序后，点击"开始钓鱼"按钮或使用热键（默认`Ctrl+Alt+F`）开始钓鱼
2. 程序会自动进入等待状态，直到识别到"等待上钩状态"
3. 当鱼上钩后，程序会自动点击鼠标并根据游戏状态做出相应操作
4. 钓鱼成功后，程序会自动进入下一轮钓鱼
5. 随时可以点击"停止钓鱼"按钮或使用热键（默认`Ctrl+Alt+Q`）停止

## 配置说明

配置文件位于`modules/auto_fisher/config.yaml`，包含以下主要设置：

- **模型配置**：模型路径、检测置信度、帧率等
- **钓鱼操作**：点击间隔、等待时间、按键时长等
- **热键设置**：开始/停止热键
- **显示设置**：状态显示位置、样式等
- **UI设置**：窗口大小、颜色主题等

## 状态说明

程序会识别以下钓鱼状态：

- **等待上钩状态(0)**：抛竿后等待鱼上钩
- **鱼上钩未提线状态(1)**：鱼已咬钩但未开始提线
- **提线中_耐力未到二分之一状态(2)**：正在拉鱼，耐力条未过半
- **提线中_耐力已到二分之一状态(3)**：正在拉鱼，耐力条已过半
- **向右拉_txt(4)**：需要向右拉（按D键）
- **向左拉_txt(5)**：需要向左拉（按A键）
- **钓鱼成功状态_txt(6)**：钓鱼成功，等待按F键收获

## 钓鱼流程

1. 启动钓鱼程序后，首先进入IDLE状态
2. 当检测到等待上钩状态(0)时，转为WAITING_FOR_FISH状态
3. 当检测到鱼上钩状态(1)时，开始快速点击，转为FISH_DETECTED状态
4. 进入提线中状态(2)，继续保持快速点击
5. 当检测到耐力过半状态(3)时，停止快速点击
6. 在提线过程中，根据OCR识别到的方向提示按下相应的按键
7. 当检测到钓鱼成功状态(6)时，按下F键
8. 钓鱼成功状态消失后，执行鼠标左键长按操作，重新开始新一轮钓鱼

## 模块组件

- **fishing_state_machine.py**：核心状态机逻辑
- **status_display.py**：状态显示窗口
- **model_detector.py**：YOLO模型检测器
- **ocr_processor.py**：OCR处理器
- **input_simulator.py**：输入模拟器
- **key_controller.py**：按键控制器
- **config_manager.py**：配置管理器
- **main.py**：主程序入口
- **test_state_machine.py**：状态机测试工具

## v3.0版本重构改进

在v3.0版本中，我们对钓鱼模块进行了全面重构，主要改进包括：

1. **状态稳定性**：增加状态检测计数器，确保状态变化的稳定性
2. **点击控制**：重写快速点击机制，更精确地控制点击频率和响应性
3. **错误处理**：增强错误处理和恢复机制，提高系统稳定性
4. **单进程状态**：严格实现单进程状态处理，确保状态转换的正确性
5. **状态显示**：重新设计状态显示窗口，提供更丰富的信息
6. **测试工具**：增加测试工具，便于调试和验证

## 故障排除

- **程序无法启动**：检查依赖是否安装完整，Python版本是否正确
- **无法识别状态**：检查模型路径是否正确，调整检测置信度
- **操作不正确**：调整点击间隔和按键时长
- **热键无效**：检查热键是否被其他程序占用
- **状态转换异常**：调整状态检测阈值，确保状态稳定性
- **点击响应慢**：检查点击线程是否正常运行，调整点击间隔

## 开发信息

- 版本：3.0.0
- 开发语言：Python
- 深度学习框架：PyTorch + YOLO
- UI框架：Tkinter 